<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Delta _lake01 | Ming’s Daily Action</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Delta _lake01" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Delta Lake 01" />
<meta property="og:description" content="Delta Lake 01" />
<link rel="canonical" href="https://itsming97.github.io/how-to-be-rengoku-diary/2021/08/06/Delta-_Lake01.html" />
<meta property="og:url" content="https://itsming97.github.io/how-to-be-rengoku-diary/2021/08/06/Delta-_Lake01.html" />
<meta property="og:site_name" content="Ming’s Daily Action" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-06T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://itsming97.github.io/how-to-be-rengoku-diary/2021/08/06/Delta-_Lake01.html","@type":"BlogPosting","headline":"Delta _lake01","dateModified":"2021-08-06T00:00:00-05:00","datePublished":"2021-08-06T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://itsming97.github.io/how-to-be-rengoku-diary/2021/08/06/Delta-_Lake01.html"},"description":"Delta Lake 01","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/how-to-be-rengoku-diary/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://itsming97.github.io/how-to-be-rengoku-diary/feed.xml" title="Ming's Daily Action" /><link rel="shortcut icon" type="image/x-icon" href="/how-to-be-rengoku-diary/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/how-to-be-rengoku-diary/">Ming&#39;s Daily Action</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/how-to-be-rengoku-diary/about/">About Me</a><a class="page-link" href="/how-to-be-rengoku-diary/search/">Search</a><a class="page-link" href="/how-to-be-rengoku-diary/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Delta _lake01</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-08-06T00:00:00-05:00" itemprop="datePublished">
        Aug 6, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      2 min read
    
</span></p>

    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><strong>Delta Lake 01</strong></p>

<p>I examinate how to load data in and out from my local machine to delta lake. As far as I understand, delta lake is built on top of spark. It is more like a special format or special class for me. Most importantly, it provides ACID. I ran all the codes on windows power shell as I set up the environment there. This notebook is in the anaconda environment. I tried to run the same codes here so that we can see output as well. However, the configuration took me a while and it still failed so I used the markdown format.</p>

<h3 id="run-pyspark-with-the-delta-lake-package-and-additional-configurations">Run PySpark with the Delta Lake package and additional configurations:</h3>

<p>pyspark –packages io.delta:delta-core_2.12:1.0.0 –conf “spark.sql.extensions=io.delta.sql.DeltaSparkSessionExtension” –conf “spark.sql.catalog.spark_catalog=org.apache.spark.sql.delta.catalog.DeltaCatalog”</p>

<h3 id="then-i-load-the-data-into-spark">Then I load the data into spark:</h3>

<p>data = spark.read.load(“path to the local file”)</p>

<p>pq=data.write.format(“delta”).save(“/tmp/pq-table”)</p>

<p>df = spark.read.format(“delta”).load(“/tmp/pq-table”)</p>

<p>The /tmp is a directory to save temporary files. pq-table is a delta object. Names have to be unique. For this particular file, one of the columns has a space in its name. The space or other special characters will stop the table becoming a delta table. Therefore, I dropped the column just because of convenience. I tried .withColumnRenamed() but it didn’t work. I should try alias, but I am still learning that.</p>

<h3 id="partition-and-write-the-dataset">Partition and write the dataset:</h3>

<p>df.write \</p>

<p>.format(“delta”) \</p>

<p>.partitionBy(“Date”) \</p>

<p>.saveAsTable(“stock”)</p>

<p>The codes above would write the dataset from spark to local machine at the current directory. PartitionBy would create different sub-directories under the current directory. However, each unique value is one directory. I extracted year and month out and put them into PartitionBy, but they don’t work. If we want nested directories like below (example). We might have to create the year and month columns, but I know that it would be redundant and that’s not what we want. I would keep looking for solutions for this.</p>

<p>We can also use bucketing, but a buckets number has to be assigned in that function, so I think it is not ideal.</p>

<p>Example:</p>

<p>Root:</p>

<table>
  <tbody>
    <tr>
      <td>–year1</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>—-Month1</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>——day1</td>
    </tr>
  </tbody>
</table>

<h3 id="output-of-the-write">Output of the write:</h3>

<p><img src="https://itsming97.github.io/how-to-be-rengoku-diary/assets/img/2021-08-06-Delta-_Lake01/media/image1.png" alt="" /></p>

<h3 id="next-step">Next Step:</h3>

<ul>
  <li>
    <p>Keep looking for solutions to address how to write the dataset out into nested folders based on column</p>
  </li>
  <li>
    <p>Learn how to move data from cloud platform/database connections/API to spark and then partition out to cloud platform. Like S3 -&gt; Spark -&gt; S3</p>
  </li>
  <li>
    <p>How to apply python profiling to the delta table</p>
  </li>
</ul>

<p><strong>Questions:</strong></p>

<ul>
  <li>
    <p>Relationship between Spark and Delta Lake. Like how does the parquet file move to spark then move to Delta Lake? Or is it simply changing the spark dataframe into delta format? Like change it to a different class in python. I understand that Delta Lake would provide ACID which spark does not have. It makes sense if ACID is critical to our goal. However, if we use Delta Lake just because of partitioning. I think the original spark already has the partitioning function.</p>
  </li>
  <li>
    <p>Need to figure out all these different paths. Some are cloud path and some are local paths. How to access these directories and manage the files in those directory.</p>
  </li>
</ul>

  </div><a class="u-url" href="/how-to-be-rengoku-diary/2021/08/06/Delta-_Lake01.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/how-to-be-rengoku-diary/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/how-to-be-rengoku-diary/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/how-to-be-rengoku-diary/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>record and share my progress everyday (if possible);Rengoku is one of my favorite charactor from Demon Slayer :)</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/itsming97" title="itsming97"><svg class="svg-icon grey"><use xlink:href="/how-to-be-rengoku-diary/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
